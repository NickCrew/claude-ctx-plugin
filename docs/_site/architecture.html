<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Architecture | Claude CTX Plugin</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Architecture" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive context management plugin for Claude Code" />
<meta property="og:description" content="Comprehensive context management plugin for Claude Code" />
<link rel="canonical" href="http://localhost:4000/claude-ctx-plugin/architecture.html" />
<meta property="og:url" content="http://localhost:4000/claude-ctx-plugin/architecture.html" />
<meta property="og:site_name" content="Claude CTX Plugin" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Architecture" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Comprehensive context management plugin for Claude Code","headline":"Architecture","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/claude-ctx-plugin/assets/images/hero.png"}},"url":"http://localhost:4000/claude-ctx-plugin/architecture.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/claude-ctx-plugin/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/claude-ctx-plugin/feed.xml" title="Claude CTX Plugin" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/claude-ctx-plugin/">Claude CTX Plugin</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/claude-ctx-plugin/">Overview</a><a class="page-link" href="/claude-ctx-plugin/getting-started.html">Getting Started</a><a class="page-link" href="/claude-ctx-plugin/architecture.html">Architecture</a><a class="page-link" href="/claude-ctx-plugin/agents.html">Agents</a><a class="page-link" href="/claude-ctx-plugin/skills.html">Skills</a><a class="page-link" href="/claude-ctx-plugin/model-optimization.html">Model Optimization</a><a class="page-link" href="/claude-ctx-plugin/commands.html">Command Reference</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h1 id="claude-ctx-architecture--design">claude-ctx Architecture &amp; Design</h1>

<p>Comprehensive architecture documentation for the claude-ctx context management framework.</p>

<h2 id="overview">Overview</h2>

<p>claude-ctx is a sophisticated context orchestration framework for Claude Code that provides:</p>

<ul>
  <li><strong>On-Demand Loading</strong>: Agents, modes, and skills load only when needed</li>
  <li><strong>Dependency Management</strong>: Automatic resolution of agent dependencies</li>
  <li><strong>Progressive Disclosure</strong>: Skills load knowledge in tiers (metadata → instructions → resources)</li>
  <li><strong>Hybrid Orchestration</strong>: Strategic Haiku/Sonnet model assignment for cost/performance</li>
  <li><strong>Workflow Automation</strong>: Multi-phase structured workflows with metrics</li>
  <li><strong>Project Intelligence</strong>: Auto-detection and context-aware initialization</li>
</ul>

<h2 id="core-philosophy">Core Philosophy</h2>

<h3 id="1-context-efficiency">1. Context Efficiency</h3>
<p>Load only what’s needed, when it’s needed. Reduce token usage through progressive disclosure and intelligent activation.</p>

<h3 id="2-dependency-driven-activation">2. Dependency-Driven Activation</h3>
<p>Agents declare their dependencies (<code class="language-plaintext highlighter-rouge">requires</code> and <code class="language-plaintext highlighter-rouge">recommends</code>), enabling automatic resolution and validation.</p>

<h3 id="3-structured-workflows">3. Structured Workflows</h3>
<p>Every agent follows multi-phase workflows (discovery → implementation → validation) with measurable outcomes.</p>

<h3 id="4-observable-execution">4. Observable Execution</h3>
<p>Track metrics per agent (latency, coverage, success rates) for continuous optimization.</p>

<h3 id="5-project-aware-intelligence">5. Project-Aware Intelligence</h3>
<p>Auto-detect project type, language, and framework to activate relevant agents and modes.</p>

<hr />

<h2 id="system-architecture">System Architecture</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────────────────────────────────────────────────────────┐
│                    Claude Code Interface                     │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                   claude-ctx CLI                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  Agent Mgmt  │  │  Skill Mgmt  │  │  Init System │      │
│  │              │  │              │  │              │      │
│  │ activate     │  │ list         │  │ detect       │      │
│  │ deactivate   │  │ info         │  │ wizard       │      │
│  │ deps         │  │ validate     │  │ profile      │      │
│  │ graph        │  │              │  │              │      │
│  └──────────────┘  └──────────────┘  └──────────────┘      │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│               Context Resolution Engine                      │
│                                                              │
│  ┌────────────────────────────────────────────────────┐    │
│  │  Dependency Graph     →  Activation Logic          │    │
│  │  Trigger Matching     →  Skill Loading             │    │
│  │  Model Selection      →  Workflow Orchestration    │    │
│  └────────────────────────────────────────────────────┘    │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│                   Context Storage                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │  agents/ │  │  skills/ │  │  modes/  │  │ profiles/│   │
│  │          │  │          │  │          │  │          │   │
│  │ 11 active│  │ 2 skills │  │ 3 modes  │  │ 3 saved  │   │
│  │ 67 inact │  │          │  │ 4 inact  │  │          │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
</code></pre></div></div>

<hr />

<h2 id="component-details">Component Details</h2>

<h3 id="agent-system">Agent System</h3>

<p><strong>Structure:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>agents/
├── agent-name.md              # Active agent (loaded when triggered)
└── dependencies.map           # Dependency graph export

agents-disabled/
└── agent-name.md              # Inactive (can be activated via CLI)
</code></pre></div></div>

<p><strong>Agent Frontmatter (v2.0):</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">2.0</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">backend-architect</span>
<span class="na">alias</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">server-architect</span><span class="pi">]</span>
<span class="na">summary</span><span class="pi">:</span> <span class="s">One-line description</span>
<span class="na">description</span><span class="pi">:</span> <span class="pi">|</span>
  <span class="s">Detailed multi-line description</span>
<span class="na">category</span><span class="pi">:</span> <span class="s">core-development</span>
<span class="na">tags</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">backend</span><span class="pi">,</span> <span class="nv">architecture</span><span class="pi">,</span> <span class="nv">reliability</span><span class="pi">]</span>
<span class="na">tier</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span> <span class="s">core</span>
  <span class="na">activation_strategy</span><span class="pi">:</span> <span class="s">tiered</span>
  <span class="na">conditions</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">**/api/**"</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">**/services/**"</span>
<span class="na">model</span><span class="pi">:</span>
  <span class="na">preference</span><span class="pi">:</span> <span class="s">sonnet</span>                    <span class="c1"># or haiku</span>
  <span class="na">fallbacks</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">haiku</span><span class="pi">]</span>
  <span class="na">reasoning</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Complex</span><span class="nv"> </span><span class="s">architectural</span><span class="nv"> </span><span class="s">analysis"</span>
  <span class="na">escalation</span><span class="pi">:</span>                           <span class="c1"># optional</span>
    <span class="na">to</span><span class="pi">:</span> <span class="s">sonnet</span>
    <span class="na">when</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">architectural</span><span class="nv"> </span><span class="s">refactoring"</span><span class="pi">]</span>
<span class="na">tools</span><span class="pi">:</span>
  <span class="na">catalog</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">Read</span><span class="pi">,</span> <span class="nv">Write</span><span class="pi">,</span> <span class="nv">MultiEdit</span><span class="pi">,</span> <span class="nv">Exec</span><span class="pi">]</span>
  <span class="na">tiers</span><span class="pi">:</span>
    <span class="na">core</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">Read</span><span class="pi">,</span> <span class="nv">Write</span><span class="pi">]</span>
    <span class="na">enhanced</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">Exec</span><span class="pi">]</span>
    <span class="na">specialist</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">MultiEdit</span><span class="pi">]</span>
<span class="na">activation</span><span class="pi">:</span>
  <span class="na">keywords</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">backend</span><span class="nv"> </span><span class="s">architecture"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">api</span><span class="nv"> </span><span class="s">design"</span><span class="pi">]</span>
  <span class="na">auto</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">priority</span><span class="pi">:</span> <span class="s">high</span>
<span class="na">dependencies</span><span class="pi">:</span>
  <span class="na">requires</span><span class="pi">:</span> <span class="pi">[]</span>                          <span class="c1"># Must be active</span>
  <span class="na">recommends</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">database-optimizer</span><span class="pi">]</span>      <span class="c1"># Nice to have</span>
<span class="na">skills</span><span class="pi">:</span>                                 <span class="c1"># NEW: Agent skills</span>
  <span class="pi">-</span> <span class="s">api-design-patterns</span>
  <span class="pi">-</span> <span class="s">microservices-patterns</span>
<span class="na">workflows</span><span class="pi">:</span>
  <span class="na">default</span><span class="pi">:</span> <span class="s">backend-architecture</span>
  <span class="na">phases</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">discovery</span>
      <span class="na">responsibilities</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Analyze requirements</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">design</span>
      <span class="na">responsibilities</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Produce service contracts</span>
<span class="na">metrics</span><span class="pi">:</span>
  <span class="na">tracked</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">latency_budget_ms</span>
    <span class="pi">-</span> <span class="s">availability_slo</span>
<span class="nn">---</span>
</code></pre></div></div>

<p><strong>Dependency Graph:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cloud-architect
├── recommends: terraform-specialist
├── recommends: kubernetes-architect
└── workflow: assessment → architecture → enablement

backend-architect
├── recommends: database-optimizer
├── recommends: security-auditor
├── recommends: performance-engineer
├── skills: api-design-patterns, microservices-patterns
└── workflow: discovery → design → evolution

deployment-engineer
├── requires: cloud-architect
├── recommends: kubernetes-architect
├── recommends: terraform-specialist
└── workflow: assessment → implementation → verification
</code></pre></div></div>

<hr />

<h3 id="skill-system">Skill System</h3>

<p><strong>Purpose</strong>: Progressive disclosure of specialized knowledge to reduce token usage.</p>

<p><strong>Structure:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>skills/
├── api-design-patterns/
│   └── SKILL.md                # ~1,800 tokens
├── microservices-patterns/
│   └── SKILL.md                # ~3,200 tokens
└── README.md
</code></pre></div></div>

<p><strong>Skill Frontmatter:</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">api-design-patterns</span>
<span class="na">description</span><span class="pi">:</span> <span class="s">REST/GraphQL patterns with versioning, pagination, error handling. Use when designing APIs, defining endpoints, or architecting service contracts.</span>
<span class="nn">---</span>

<span class="c1"># Skill Content (Progressive Tiers)</span>

<span class="c1">## When to Use This Skill</span>
<span class="pi">[</span><span class="nv">Activation criteria</span><span class="pi">]</span>

<span class="c1">## Core Patterns</span>
<span class="pi">[</span><span class="nv">Essential knowledge - 40% of content</span><span class="pi">]</span>

<span class="c1">## Advanced Patterns</span>
<span class="pi">[</span><span class="nv">Detailed examples - 40% of content</span><span class="pi">]</span>

<span class="c1">## Resources</span>
<span class="pi">[</span><span class="nv">References and links - 20% of content</span><span class="pi">]</span>
</code></pre></div></div>

<p><strong>Loading Strategy:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. Agent activated → Load agent core content (~3K tokens)
2. Skill triggered → Load skill metadata (~50 tokens)
3. Skill needed → Load skill instructions (~1.8K tokens)
4. Resources requested → Load additional examples (~500 tokens)

Total: 3K + 50 + 1.8K = 4.85K (vs. 8K without skills)
Savings: 39%
</code></pre></div></div>

<hr />

<h3 id="mode-system">Mode System</h3>

<p><strong>Purpose</strong>: Toggle workflow defaults and behavioral presets.</p>

<p><strong>Structure:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>modes/
├── Task_Management.md         # Active mode
├── Project_Memory.md
└── Agile_Sprint.md

modes-inactive/
├── Deep_Analysis.md
├── Rapid_Prototyping.md
└── Documentation_Focus.md
</code></pre></div></div>

<p><strong>Mode Content:</strong></p>
<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gh"># Mode: Task Management</span>

<span class="gu">## Activation</span>
<span class="p">-</span> Multi-step operations (&gt;3 steps)
<span class="p">-</span> Complex scope (&gt;2 directories OR &gt;3 files)

<span class="gu">## Behavior Modifications</span>
<span class="p">1.</span> ALWAYS use TodoWrite for task tracking
<span class="p">2.</span> Mark tasks in_progress before starting
<span class="p">3.</span> Mark completed immediately after finishing
<span class="p">4.</span> One task in_progress at a time

<span class="gu">## Tool Preferences</span>
<span class="p">-</span> Prefer Task agents for delegation
<span class="p">-</span> Use parallel operations when independent
</code></pre></div></div>

<hr />

<h3 id="profile-system">Profile System</h3>

<p><strong>Purpose</strong>: Save and restore agent/mode/rule configurations.</p>

<p><strong>Structure:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>profiles/
├── minimal.profile            # Essential agents only
├── backend.profile            # Backend development stack
└── full-stack.profile         # Complete development environment
</code></pre></div></div>

<p><strong>Profile Format:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Profile: backend</span>
<span class="c"># Generated: 2024-01-15 10:30:00</span>

<span class="c"># Active agents</span>
<span class="nv">AGENTS</span><span class="o">=</span><span class="s2">"python-pro backend-architect database-optimizer security-auditor"</span>

<span class="c"># Active modes</span>
<span class="nv">MODES</span><span class="o">=</span><span class="s2">"Task_Management"</span>

<span class="c"># Active rules</span>
<span class="nv">RULES</span><span class="o">=</span><span class="s2">"workflow-rules quality-rules"</span>
</code></pre></div></div>

<hr />

<h3 id="init-system">Init System</h3>

<p><strong>Purpose</strong>: Auto-detect project context and configure claude-ctx appropriately.</p>

<p><strong>Workflow:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. detect → Analyze project structure
   - Language detection (package.json, requirements.txt, etc.)
   - Framework detection (FastAPI, React, Django, etc.)
   - Tool detection (Docker, K8s, Terraform, etc.)

2. profile → Recommend profile based on detection
   - Python + FastAPI → backend + python-pro + api patterns
   - TypeScript + React → frontend + typescript-pro + react-specialist
   - Monorepo → full-stack + multi-agent-coordinator

3. wizard → Interactive configuration
   - User confirms/adjusts recommendations
   - Activate agents, modes, skills
   - Save as project-specific profile

4. status → Show current configuration
   - Active agents with dependencies
   - Loaded skills
   - Active modes
</code></pre></div></div>

<p><strong>Detection Cache:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/.claude/.init/
├── projects/
│   └── project-slug-abc123.json      # Cached detection results
└── cache/
    └── last-session.json              # Resume interrupted init
</code></pre></div></div>

<hr />

<h2 id="workflow-orchestration">Workflow Orchestration</h2>

<h3 id="multi-phase-workflows">Multi-Phase Workflows</h3>

<p><strong>Pattern:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Phase 1: Discovery/Assessment
  - Gather context and requirements
  - Map existing systems
  - Identify constraints

Phase 2: Design/Implementation
  - Produce artifacts
  - Apply patterns
  - Build solutions

Phase 3: Validation/Evolution
  - Test and verify
  - Document
  - Hand off
</code></pre></div></div>

<p><strong>Example: Backend Feature Development</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/dev:implement "user authentication API"

1. backend-architect (Sonnet)
   Phase: discovery
   - Analyze auth requirements
   - Map security constraints
   Outputs: API spec, security requirements

2. backend-architect (Sonnet)
   Phase: design
   - Design JWT flow
   - Define endpoints
   - Activates skill: api-design-patterns
   Outputs: OpenAPI spec

3. python-pro (Haiku)
   Phase: implementation
   - Implement endpoints
   - Apply FastAPI patterns
   Outputs: auth.py, routes.py

4. test-automator (Haiku)
   Phase: validation
   - Generate unit tests
   - Generate integration tests
   Outputs: test_auth.py

5. security-auditor (Sonnet)
   Phase: validation
   - Review auth implementation
   - Check OWASP compliance
   Outputs: Security report

6. code-reviewer (Sonnet)
   Phase: validation
   - Architectural review
   - Code quality check
   Outputs: Review comments

Total: 3 Sonnet + 2 Haiku calls
Cost: ~40% less than all-Sonnet
</code></pre></div></div>

<hr />

<h2 id="model-optimization">Model Optimization</h2>

<h3 id="hybrid-strategy">Hybrid Strategy</h3>

<p><strong>Sonnet 4.5 (27 agents):</strong></p>
<ul>
  <li>Architecture &amp; Design</li>
  <li>Security &amp; Compliance</li>
  <li>Incident &amp; Troubleshooting</li>
  <li>Code Review (with architectural considerations)</li>
  <li>Business &amp; Product</li>
</ul>

<p><strong>Haiku 4 (31 agents):</strong></p>
<ul>
  <li>Code Generation</li>
  <li>Testing</li>
  <li>Infrastructure as Code</li>
  <li>Documentation</li>
  <li>Build &amp; Deployment</li>
  <li>Data Processing</li>
</ul>

<p><strong>Context-Dependent (9 agents):</strong></p>
<ul>
  <li>Default to Haiku, escalate to Sonnet for complex cases</li>
</ul>

<p><strong>Cost Savings:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>All Sonnet: $15 per 1M tokens × 1000 tasks = $15,000
Hybrid: $4.76 per task × 1000 = $4,760
Savings: 68%
</code></pre></div></div>

<hr />

<h2 id="performance-characteristics">Performance Characteristics</h2>

<h3 id="latency">Latency</h3>

<table>
  <thead>
    <tr>
      <th>Operation</th>
      <th>Latency</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Agent activation</td>
      <td>&lt;10ms</td>
      <td>Filesystem read + YAML parse</td>
    </tr>
    <tr>
      <td>Skill loading</td>
      <td>&lt;5ms</td>
      <td>Metadata only</td>
    </tr>
    <tr>
      <td>Dependency resolution</td>
      <td>&lt;20ms</td>
      <td>Graph traversal</td>
    </tr>
    <tr>
      <td>CLI command</td>
      <td>&lt;100ms</td>
      <td>Python startup + execution</td>
    </tr>
  </tbody>
</table>

<h3 id="scalability">Scalability</h3>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>Current</th>
      <th>Target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Total agents</td>
      <td>78</td>
      <td>100+</td>
    </tr>
    <tr>
      <td>Active agents</td>
      <td>11</td>
      <td>20-30 typical</td>
    </tr>
    <tr>
      <td>Skills per agent</td>
      <td>0-3</td>
      <td>2-5</td>
    </tr>
    <tr>
      <td>Context size</td>
      <td>5-15K tokens</td>
      <td>Target &lt;10K</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="design-patterns">Design Patterns</h2>

<h3 id="pattern-1-lazy-loading">Pattern 1: Lazy Loading</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Problem: Loading all agents consumes excessive tokens
Solution: Load agents only when triggered by keywords/patterns
Benefit: 60-80% token reduction
</code></pre></div></div>

<h3 id="pattern-2-dependency-injection">Pattern 2: Dependency Injection</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Problem: Agents need other agents but tight coupling
Solution: Declare dependencies in frontmatter, auto-resolve
Benefit: Loose coupling, validation, clear relationships
</code></pre></div></div>

<h3 id="pattern-3-progressive-disclosure">Pattern 3: Progressive Disclosure</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Problem: Heavyweight agents with rarely-used knowledge
Solution: Extract knowledge into skills, load on-demand
Benefit: 30-50% token reduction per agent
</code></pre></div></div>

<h3 id="pattern-4-strategy-pattern-model-selection">Pattern 4: Strategy Pattern (Model Selection)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Problem: One model doesn't fit all tasks
Solution: Assign Haiku/Sonnet based on complexity
Benefit: 40-60% cost savings
</code></pre></div></div>

<h3 id="pattern-5-command-pattern-cli">Pattern 5: Command Pattern (CLI)</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Problem: Complex operations need structured interface
Solution: CLI with subcommands (agent, skill, init, etc.)
Benefit: Discoverability, automation, scripting
</code></pre></div></div>

<hr />

<h2 id="anti-patterns-to-avoid">Anti-Patterns to Avoid</h2>

<ol>
  <li><strong>Monolithic Agents</strong>: Keep agents focused, extract knowledge to skills</li>
  <li><strong>Circular Dependencies</strong>: Agents should form DAG, not cycles</li>
  <li><strong>Missing Activation Criteria</strong>: Always define keywords and conditions</li>
  <li><strong>Ignoring Model Optimization</strong>: Use Haiku for deterministic tasks</li>
  <li><strong>No Metrics</strong>: Track performance to inform optimization</li>
  <li><strong>Premature Agent Creation</strong>: Start with fewer, split when needed</li>
  <li><strong>Skill Explosion</strong>: Don’t create skills for every small topic</li>
  <li><strong>Shared State</strong>: Agents should be stateless (use profiles for state)</li>
</ol>

<hr />

<h2 id="extension-points">Extension Points</h2>

<h3 id="adding-new-agents">Adding New Agents</h3>

<ol>
  <li><strong>Research</strong>: Identify clear responsibility and activation criteria</li>
  <li><strong>Design</strong>: Define dependencies, workflows, metrics</li>
  <li><strong>Implement</strong>: Create agent .md with complete frontmatter</li>
  <li><strong>Validate</strong>: <code class="language-plaintext highlighter-rouge">claude-ctx agent validate agent-name</code></li>
  <li><strong>Test</strong>: Activate and verify behavior</li>
  <li><strong>Document</strong>: Add to agents.md catalog</li>
  <li><strong>Optimize</strong>: Assign appropriate model (Haiku/Sonnet)</li>
</ol>

<h3 id="creating-skills">Creating Skills</h3>

<ol>
  <li><strong>Identify</strong>: Find 1000+ token knowledge chunks in agents</li>
  <li><strong>Extract</strong>: Create skill/ directory with SKILL.md</li>
  <li><strong>Structure</strong>: Frontmatter + progressive tiers</li>
  <li><strong>Link</strong>: Add skill to agent frontmatter</li>
  <li><strong>Validate</strong>: <code class="language-plaintext highlighter-rouge">claude-ctx skills validate skill-name</code></li>
  <li><strong>Document</strong>: Update skills/README.md</li>
</ol>

<h3 id="custom-workflows">Custom Workflows</h3>

<ol>
  <li><strong>Define</strong>: Identify multi-phase process</li>
  <li><strong>Map Agents</strong>: Which agents participate in each phase</li>
  <li><strong>Create Command</strong>: Add to commands/ directory</li>
  <li><strong>Orchestrate</strong>: Define agent sequence and data flow</li>
  <li><strong>Measure</strong>: Track metrics and optimize</li>
</ol>

<hr />

<h2 id="future-enhancements">Future Enhancements</h2>

<h3 id="smart-routing">Smart Routing</h3>
<ul>
  <li>Analyze task complexity before model selection</li>
  <li>Auto-escalate from Haiku to Sonnet when confidence low</li>
  <li>Learn from corrections</li>
</ul>

<h3 id="auto-skill-activation">Auto-Skill Activation</h3>
<ul>
  <li>Parse user intent for skill keywords</li>
  <li>Load skills proactively based on context</li>
  <li>Track skill effectiveness</li>
</ul>

<h3 id="cross-session-memory">Cross-Session Memory</h3>
<ul>
  <li>Persist agent state between sessions</li>
  <li>Remember user preferences and patterns</li>
  <li>Build project-specific knowledge base</li>
</ul>

<h3 id="distributed-execution">Distributed Execution</h3>
<ul>
  <li>Parallel agent execution for independent tasks</li>
  <li>Queue-based orchestration for complex workflows</li>
  <li>Resource pooling and throttling</li>
</ul>

<hr />

<h2 id="resources">Resources</h2>

<ul>
  <li><a href="/claude-ctx-plugin/skills.html">Agent Skills Guide</a></li>
  <li><a href="/claude-ctx-plugin/agents.html">Agent Catalog</a></li>
  <li><a href="/claude-ctx-plugin/model-optimization.html">Model Optimization</a></li>
  <li><a href="../README.md#using-the-bundled-cli">CLI Reference</a></li>
  <li><a href="../workflows/">Workflow Patterns</a></li>
</ul>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/claude-ctx-plugin/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Claude CTX Plugin</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Claude CTX Plugin</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Comprehensive context management plugin for Claude Code</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
