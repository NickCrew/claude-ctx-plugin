{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Skill Analytics Schema",
  "description": "Comprehensive analytics tracking schema for skill performance, effectiveness, and optimization",
  "type": "object",
  "required": ["version", "metadata", "activations", "sessions"],
  "properties": {
    "version": {
      "type": "string",
      "description": "Schema version for forward compatibility",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0"
    },
    "metadata": {
      "type": "object",
      "description": "Global analytics metadata",
      "required": ["created_at", "last_updated"],
      "properties": {
        "created_at": {
          "type": "string",
          "format": "date-time",
          "description": "When analytics tracking was initialized"
        },
        "last_updated": {
          "type": "string",
          "format": "date-time",
          "description": "Last time analytics were updated"
        },
        "total_activations": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of skill activations tracked"
        },
        "total_sessions": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of sessions tracked"
        },
        "tracking_period": {
          "type": "object",
          "properties": {
            "start": {
              "type": "string",
              "format": "date-time"
            },
            "end": {
              "type": "string",
              "format": "date-time"
            }
          }
        }
      }
    },
    "activations": {
      "type": "array",
      "description": "Detailed records of individual skill activations",
      "items": {
        "type": "object",
        "required": [
          "activation_id",
          "skill_name",
          "timestamp",
          "context",
          "metrics",
          "effectiveness"
        ],
        "properties": {
          "activation_id": {
            "type": "string",
            "description": "Unique identifier for this activation",
            "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
          },
          "skill_name": {
            "type": "string",
            "description": "Name of the activated skill",
            "minLength": 1,
            "maxLength": 100
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of activation"
          },
          "session_id": {
            "type": "string",
            "description": "Associated session identifier",
            "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
          },
          "context": {
            "type": "object",
            "description": "Contextual information about the activation",
            "required": ["trigger", "environment"],
            "properties": {
              "trigger": {
                "type": "object",
                "description": "What triggered the skill activation",
                "required": ["type", "source"],
                "properties": {
                  "type": {
                    "type": "string",
                    "enum": [
                      "user_command",
                      "auto_detection",
                      "slash_command",
                      "flag_based",
                      "pattern_match",
                      "dependency_chain"
                    ]
                  },
                  "source": {
                    "type": "string",
                    "description": "Specific trigger source (e.g., command text, pattern matched)"
                  },
                  "confidence": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Confidence score for auto-detection triggers"
                  }
                }
              },
              "environment": {
                "type": "object",
                "description": "Environment context at activation time",
                "properties": {
                  "working_directory": {
                    "type": "string"
                  },
                  "project_type": {
                    "type": "string",
                    "description": "Type of project (e.g., 'react', 'node', 'python')"
                  },
                  "git_branch": {
                    "type": "string"
                  },
                  "file_count": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "codebase_size": {
                    "type": "string",
                    "enum": ["small", "medium", "large", "xlarge"]
                  }
                }
              },
              "user_intent": {
                "type": "object",
                "description": "Interpreted user intent",
                "properties": {
                  "primary_goal": {
                    "type": "string",
                    "description": "Primary goal (e.g., 'implement_feature', 'debug_issue', 'refactor')"
                  },
                  "complexity": {
                    "type": "string",
                    "enum": ["trivial", "simple", "moderate", "complex", "very_complex"]
                  },
                  "scope": {
                    "type": "string",
                    "enum": ["file", "module", "component", "project", "system"]
                  }
                }
              },
              "dependencies": {
                "type": "array",
                "description": "Other skills or tools this activation depends on",
                "items": {
                  "type": "string"
                }
              },
              "flags": {
                "type": "array",
                "description": "Active flags during activation",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "metrics": {
            "type": "object",
            "description": "Performance and execution metrics",
            "required": ["execution_time_ms", "tool_calls"],
            "properties": {
              "execution_time_ms": {
                "type": "integer",
                "minimum": 0,
                "description": "Total execution time in milliseconds"
              },
              "tool_calls": {
                "type": "object",
                "description": "Tool usage statistics",
                "properties": {
                  "total": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "by_type": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "integer",
                      "minimum": 0
                    }
                  },
                  "parallel_batches": {
                    "type": "integer",
                    "minimum": 0,
                    "description": "Number of parallel tool execution batches"
                  }
                }
              },
              "token_usage": {
                "type": "object",
                "properties": {
                  "input_tokens": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "output_tokens": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "total_tokens": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "efficiency_score": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Token efficiency relative to task complexity"
                  }
                }
              },
              "files_modified": {
                "type": "object",
                "properties": {
                  "count": {
                    "type": "integer",
                    "minimum": 0
                  },
                  "types": {
                    "type": "object",
                    "additionalProperties": {
                      "type": "integer"
                    }
                  },
                  "total_lines_changed": {
                    "type": "integer",
                    "minimum": 0
                  }
                }
              },
              "commands_executed": {
                "type": "integer",
                "minimum": 0,
                "description": "Number of bash commands executed"
              },
              "error_count": {
                "type": "integer",
                "minimum": 0,
                "description": "Number of errors encountered"
              },
              "retry_count": {
                "type": "integer",
                "minimum": 0,
                "description": "Number of retry attempts"
              }
            }
          },
          "effectiveness": {
            "type": "object",
            "description": "Effectiveness and outcome measurements",
            "required": ["status", "goal_achievement"],
            "properties": {
              "status": {
                "type": "string",
                "enum": [
                  "completed",
                  "partial",
                  "failed",
                  "abandoned",
                  "delegated"
                ],
                "description": "Final status of the activation"
              },
              "goal_achievement": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Score indicating how well the goal was achieved (0-1)"
              },
              "quality_score": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Overall quality score of the output"
              },
              "user_satisfaction": {
                "type": "object",
                "description": "User satisfaction indicators",
                "properties": {
                  "explicit_rating": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 5,
                    "description": "Explicit user rating (1-5)"
                  },
                  "implicit_signals": {
                    "type": "object",
                    "properties": {
                      "immediate_followup": {
                        "type": "boolean",
                        "description": "User asked for immediate corrections"
                      },
                      "reactivated_same_skill": {
                        "type": "boolean",
                        "description": "User reactivated the same skill for similar task"
                      },
                      "session_continued": {
                        "type": "boolean",
                        "description": "User continued working in the same session"
                      }
                    }
                  }
                }
              },
              "validation_results": {
                "type": "object",
                "description": "Automated validation results",
                "properties": {
                  "tests_passed": {
                    "type": "boolean"
                  },
                  "lint_passed": {
                    "type": "boolean"
                  },
                  "type_check_passed": {
                    "type": "boolean"
                  },
                  "build_succeeded": {
                    "type": "boolean"
                  }
                }
              },
              "issues": {
                "type": "array",
                "description": "Issues encountered during execution",
                "items": {
                  "type": "object",
                  "required": ["type", "description"],
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": [
                        "execution_error",
                        "validation_failure",
                        "missing_dependency",
                        "permission_error",
                        "timeout",
                        "resource_limit",
                        "user_interruption"
                      ]
                    },
                    "description": {
                      "type": "string"
                    },
                    "severity": {
                      "type": "string",
                      "enum": ["low", "medium", "high", "critical"]
                    },
                    "resolved": {
                      "type": "boolean"
                    }
                  }
                }
              },
              "outcome_artifacts": {
                "type": "array",
                "description": "Artifacts produced by the activation",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": [
                        "code",
                        "test",
                        "documentation",
                        "configuration",
                        "build_output",
                        "report"
                      ]
                    },
                    "path": {
                      "type": "string"
                    },
                    "size_bytes": {
                      "type": "integer",
                      "minimum": 0
                    }
                  }
                }
              }
            }
          },
          "learning_signals": {
            "type": "object",
            "description": "Signals for improving future activations",
            "properties": {
              "pattern_match_accuracy": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "How accurately the skill matched the user's need"
              },
              "tool_selection_efficiency": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Efficiency of tool selection decisions"
              },
              "bottlenecks": {
                "type": "array",
                "description": "Performance bottlenecks identified",
                "items": {
                  "type": "object",
                  "properties": {
                    "phase": {
                      "type": "string",
                      "description": "Which phase had the bottleneck"
                    },
                    "duration_ms": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "reason": {
                      "type": "string"
                    }
                  }
                }
              },
              "improvement_suggestions": {
                "type": "array",
                "description": "Suggestions for improving this skill",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "ab_test_variant": {
            "type": "string",
            "description": "A/B test variant identifier if applicable"
          },
          "notes": {
            "type": "string",
            "description": "Additional notes or observations",
            "maxLength": 1000
          }
        }
      }
    },
    "sessions": {
      "type": "array",
      "description": "Session-level aggregate tracking",
      "items": {
        "type": "object",
        "required": [
          "session_id",
          "started_at",
          "duration_ms",
          "activations"
        ],
        "properties": {
          "session_id": {
            "type": "string",
            "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
          },
          "started_at": {
            "type": "string",
            "format": "date-time"
          },
          "ended_at": {
            "type": "string",
            "format": "date-time"
          },
          "duration_ms": {
            "type": "integer",
            "minimum": 0,
            "description": "Total session duration in milliseconds"
          },
          "activations": {
            "type": "object",
            "description": "Activation summary for this session",
            "properties": {
              "total_count": {
                "type": "integer",
                "minimum": 0
              },
              "by_skill": {
                "type": "object",
                "additionalProperties": {
                  "type": "integer",
                  "minimum": 0
                }
              },
              "success_rate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "average_execution_time_ms": {
                "type": "number",
                "minimum": 0
              }
            }
          },
          "context": {
            "type": "object",
            "properties": {
              "project_path": {
                "type": "string"
              },
              "primary_task": {
                "type": "string"
              },
              "flags_used": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            }
          },
          "aggregated_metrics": {
            "type": "object",
            "properties": {
              "total_token_usage": {
                "type": "integer",
                "minimum": 0
              },
              "total_tool_calls": {
                "type": "integer",
                "minimum": 0
              },
              "total_files_modified": {
                "type": "integer",
                "minimum": 0
              },
              "total_commands_executed": {
                "type": "integer",
                "minimum": 0
              }
            }
          },
          "outcome": {
            "type": "object",
            "properties": {
              "session_goal_achieved": {
                "type": "boolean"
              },
              "overall_quality_score": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "user_satisfaction_score": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          }
        }
      }
    },
    "ab_tests": {
      "type": "object",
      "description": "A/B testing configuration and results",
      "properties": {
        "active_tests": {
          "type": "array",
          "description": "Currently active A/B tests",
          "items": {
            "type": "object",
            "required": [
              "test_id",
              "test_name",
              "started_at",
              "variants"
            ],
            "properties": {
              "test_id": {
                "type": "string",
                "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$"
              },
              "test_name": {
                "type": "string",
                "description": "Descriptive name for the test"
              },
              "hypothesis": {
                "type": "string",
                "description": "What is being tested"
              },
              "started_at": {
                "type": "string",
                "format": "date-time"
              },
              "target_skill": {
                "type": "string",
                "description": "Skill being tested"
              },
              "variants": {
                "type": "array",
                "description": "Test variants",
                "minItems": 2,
                "items": {
                  "type": "object",
                  "required": ["variant_id", "description", "allocation_percentage"],
                  "properties": {
                    "variant_id": {
                      "type": "string"
                    },
                    "description": {
                      "type": "string",
                      "description": "What's different in this variant"
                    },
                    "allocation_percentage": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 100,
                      "description": "Percentage of traffic allocated to this variant"
                    },
                    "configuration": {
                      "type": "object",
                      "description": "Variant-specific configuration"
                    }
                  }
                }
              },
              "metrics_to_track": {
                "type": "array",
                "description": "Key metrics for this test",
                "items": {
                  "type": "string"
                }
              },
              "success_criteria": {
                "type": "object",
                "description": "Criteria for declaring a winner",
                "properties": {
                  "primary_metric": {
                    "type": "string"
                  },
                  "minimum_sample_size": {
                    "type": "integer",
                    "minimum": 1
                  },
                  "confidence_level": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1,
                    "description": "Statistical confidence level required"
                  }
                }
              }
            }
          }
        },
        "completed_tests": {
          "type": "array",
          "description": "Completed A/B tests with results",
          "items": {
            "type": "object",
            "required": [
              "test_id",
              "test_name",
              "started_at",
              "ended_at",
              "winner"
            ],
            "properties": {
              "test_id": {
                "type": "string"
              },
              "test_name": {
                "type": "string"
              },
              "started_at": {
                "type": "string",
                "format": "date-time"
              },
              "ended_at": {
                "type": "string",
                "format": "date-time"
              },
              "winner": {
                "type": "string",
                "description": "Winning variant ID"
              },
              "results": {
                "type": "object",
                "description": "Test results by variant",
                "additionalProperties": {
                  "type": "object",
                  "properties": {
                    "sample_size": {
                      "type": "integer",
                      "minimum": 0
                    },
                    "metric_values": {
                      "type": "object",
                      "additionalProperties": {
                        "type": "number"
                      }
                    },
                    "confidence_interval": {
                      "type": "object",
                      "properties": {
                        "lower": {
                          "type": "number"
                        },
                        "upper": {
                          "type": "number"
                        }
                      }
                    }
                  }
                }
              },
              "statistical_significance": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "P-value or confidence level"
              },
              "conclusion": {
                "type": "string",
                "description": "Summary of test findings"
              },
              "action_taken": {
                "type": "string",
                "enum": [
                  "winner_promoted",
                  "no_significant_difference",
                  "test_invalidated",
                  "needs_more_data"
                ]
              }
            }
          }
        }
      }
    },
    "aggregated_insights": {
      "type": "object",
      "description": "High-level insights across all activations",
      "properties": {
        "skill_performance": {
          "type": "object",
          "description": "Performance metrics by skill",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "total_activations": {
                "type": "integer",
                "minimum": 0
              },
              "success_rate": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "average_execution_time_ms": {
                "type": "number",
                "minimum": 0
              },
              "average_quality_score": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              },
              "trend": {
                "type": "string",
                "enum": ["improving", "stable", "declining"]
              }
            }
          }
        },
        "top_performers": {
          "type": "array",
          "description": "Best performing skills",
          "items": {
            "type": "object",
            "properties": {
              "skill_name": {
                "type": "string"
              },
              "composite_score": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
              }
            }
          }
        },
        "needs_improvement": {
          "type": "array",
          "description": "Skills needing optimization",
          "items": {
            "type": "object",
            "properties": {
              "skill_name": {
                "type": "string"
              },
              "primary_issue": {
                "type": "string"
              },
              "priority": {
                "type": "string",
                "enum": ["low", "medium", "high", "critical"]
              }
            }
          }
        },
        "usage_patterns": {
          "type": "object",
          "description": "Common usage patterns detected",
          "properties": {
            "most_common_sequences": {
              "type": "array",
              "description": "Common skill activation sequences",
              "items": {
                "type": "object",
                "properties": {
                  "sequence": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  },
                  "frequency": {
                    "type": "integer",
                    "minimum": 0
                  }
                }
              }
            },
            "peak_usage_times": {
              "type": "array",
              "description": "Time periods with highest usage",
              "items": {
                "type": "object",
                "properties": {
                  "hour": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 23
                  },
                  "day_of_week": {
                    "type": "integer",
                    "minimum": 0,
                    "maximum": 6
                  },
                  "activation_count": {
                    "type": "integer",
                    "minimum": 0
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
